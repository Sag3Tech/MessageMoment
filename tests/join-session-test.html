<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Join Session Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .container {
        max-width: 600px;
        margin: 0 auto;
      }
      input,
      button {
        padding: 10px;
        margin-top: 10px;
        width: 100%;
      }
      .result {
        margin-top: 20px;
        padding: 10px;
        border: 1px solid #ddd;
        background-color: #f9f9f9;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>Join Session Test</h2>
      <p>Enter the session ID and your username to join an existing session.</p>

      <label for="session-id">Session ID:</label>
      <input type="text" id="session-id" placeholder="Enter Session ID" />

      <label for="username">Username:</label>
      <input type="text" id="username" placeholder="Enter Your Username" />

      <label for="security-code">Security Code (if Secure):</label>
      <input
        type="text"
        id="security-code"
        placeholder="Enter Security Code (if applicable)"
      />

      <button id="join-session">Join Session</button>

      <div id="result" class="result" style="display: none">
        <h3>Session Join Status</h3>
        <p id="join-status"></p>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.min.js"></script>
    <script>
      const socket = io("http://localhost:8000");

      document.getElementById("join-session").addEventListener("click", () => {
        const sessionId = document.getElementById("session-id").value;
        const username = document.getElementById("username").value;
        const securityCode = document.getElementById("security-code").value;

        if (!sessionId || !username) {
          alert("Session ID and Username are required.");
          return;
        }

        // Emit the join-room event to the server
        socket.emit("join-room", {
          sessionId,
          username,
          securityCode: securityCode || undefined,
        });

        // Listen for a successful join
        socket.on("join-success", ({ username, sessionId, participants }) => {
          document.getElementById(
            "join-status"
          ).innerText = `${username} has successfully joined the session ${sessionId}. Total participants: ${participants.length}`;
          document.getElementById("result").style.display = "block";
        });

        // Listen for user joined event
        socket.on("user-joined", ({ username, participantId }) => {
          alert(`${username} (ID: ${participantId}) has joined the room!`);
        });

        // Listen for error events
        socket.on("error", (message) => {
          alert(message || "Error while joining the room.");
        });
      });
    </script>
  </body>
</html>
